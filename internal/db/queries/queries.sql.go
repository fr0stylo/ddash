// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: queries.sql

package queries

import (
	"context"
	"database/sql"
)

const createDeployment = `-- name: CreateDeployment :one
INSERT INTO deployments (service_id, environment_id, deployed_at, status, job_url, release_ref, release_url, commit_count)
VALUES (?1, ?2, ?3, ?4,
        ?5, ?6, ?7, ?8)
RETURNING id, service_id, environment_id, deployed_at, status, job_url, release_ref, release_url, commit_count, created_at
`

type CreateDeploymentParams struct {
	ServiceID     int64
	EnvironmentID int64
	DeployedAt    string
	Status        string
	JobUrl        sql.NullString
	ReleaseRef    sql.NullString
	ReleaseUrl    sql.NullString
	CommitCount   sql.NullInt64
}

func (q *Queries) CreateDeployment(ctx context.Context, arg CreateDeploymentParams) (Deployment, error) {
	row := q.db.QueryRowContext(ctx, createDeployment,
		arg.ServiceID,
		arg.EnvironmentID,
		arg.DeployedAt,
		arg.Status,
		arg.JobUrl,
		arg.ReleaseRef,
		arg.ReleaseUrl,
		arg.CommitCount,
	)
	var i Deployment
	err := row.Scan(
		&i.ID,
		&i.ServiceID,
		&i.EnvironmentID,
		&i.DeployedAt,
		&i.Status,
		&i.JobUrl,
		&i.ReleaseRef,
		&i.ReleaseUrl,
		&i.CommitCount,
		&i.CreatedAt,
	)
	return i, err
}

const createDeploymentSimple = `-- name: CreateDeploymentSimple :one
INSERT INTO deployments (service_id, environment_id, deployed_at, status, release_ref)
VALUES (?1, ?2, ?3, ?4,
        ?5)
RETURNING id, service_id, environment_id, deployed_at, status, job_url, release_ref, release_url, commit_count, created_at
`

type CreateDeploymentSimpleParams struct {
	ServiceID     int64
	EnvironmentID int64
	DeployedAt    string
	Status        string
	ReleaseRef    sql.NullString
}

func (q *Queries) CreateDeploymentSimple(ctx context.Context, arg CreateDeploymentSimpleParams) (Deployment, error) {
	row := q.db.QueryRowContext(ctx, createDeploymentSimple,
		arg.ServiceID,
		arg.EnvironmentID,
		arg.DeployedAt,
		arg.Status,
		arg.ReleaseRef,
	)
	var i Deployment
	err := row.Scan(
		&i.ID,
		&i.ServiceID,
		&i.EnvironmentID,
		&i.DeployedAt,
		&i.Status,
		&i.JobUrl,
		&i.ReleaseRef,
		&i.ReleaseUrl,
		&i.CommitCount,
		&i.CreatedAt,
	)
	return i, err
}

const createEnvironment = `-- name: CreateEnvironment :one
INSERT INTO environments (name)
VALUES (?)
RETURNING id, name
`

func (q *Queries) CreateEnvironment(ctx context.Context, name string) (Environment, error) {
	row := q.db.QueryRowContext(ctx, createEnvironment, name)
	var i Environment
	err := row.Scan(&i.ID, &i.Name)
	return i, err
}

const createOrganization = `-- name: CreateOrganization :one
INSERT INTO organizations (name, auth_token, webhook_secret, enabled)
VALUES (?1, ?2, ?3, ?4)
RETURNING id, name, auth_token, webhook_secret, enabled, created_at, updated_at
`

type CreateOrganizationParams struct {
	Name          string
	AuthToken     string
	WebhookSecret string
	Enabled       int64
}

func (q *Queries) CreateOrganization(ctx context.Context, arg CreateOrganizationParams) (Organization, error) {
	row := q.db.QueryRowContext(ctx, createOrganization,
		arg.Name,
		arg.AuthToken,
		arg.WebhookSecret,
		arg.Enabled,
	)
	var i Organization
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.AuthToken,
		&i.WebhookSecret,
		&i.Enabled,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const createOrganizationRequiredField = `-- name: CreateOrganizationRequiredField :one
INSERT INTO organization_required_fields (organization_id, label, field_type, sort_order)
VALUES (?1, ?2, ?3, ?4)
RETURNING id, organization_id, label, field_type, sort_order, created_at, updated_at
`

type CreateOrganizationRequiredFieldParams struct {
	OrganizationID int64
	Label          string
	FieldType      string
	SortOrder      int64
}

func (q *Queries) CreateOrganizationRequiredField(ctx context.Context, arg CreateOrganizationRequiredFieldParams) (OrganizationRequiredField, error) {
	row := q.db.QueryRowContext(ctx, createOrganizationRequiredField,
		arg.OrganizationID,
		arg.Label,
		arg.FieldType,
		arg.SortOrder,
	)
	var i OrganizationRequiredField
	err := row.Scan(
		&i.ID,
		&i.OrganizationID,
		&i.Label,
		&i.FieldType,
		&i.SortOrder,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const createService = `-- name: CreateService :one
INSERT INTO services (name, integration_type)
VALUES (?, 'github')
RETURNING id, name, integration_type, description, context, team, repo_url, logs_url, endpoint_url, created_at, updated_at
`

func (q *Queries) CreateService(ctx context.Context, name string) (Service, error) {
	row := q.db.QueryRowContext(ctx, createService, name)
	var i Service
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.IntegrationType,
		&i.Description,
		&i.Context,
		&i.Team,
		&i.RepoUrl,
		&i.LogsUrl,
		&i.EndpointUrl,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const deleteOrganizationRequiredFields = `-- name: DeleteOrganizationRequiredFields :exec
DELETE FROM organization_required_fields
WHERE organization_id = ?
`

func (q *Queries) DeleteOrganizationRequiredFields(ctx context.Context, organizationID int64) error {
	_, err := q.db.ExecContext(ctx, deleteOrganizationRequiredFields, organizationID)
	return err
}

const getDefaultOrganization = `-- name: GetDefaultOrganization :one
SELECT id, name, auth_token, webhook_secret, enabled, created_at, updated_at
FROM organizations
ORDER BY id
LIMIT 1
`

func (q *Queries) GetDefaultOrganization(ctx context.Context) (Organization, error) {
	row := q.db.QueryRowContext(ctx, getDefaultOrganization)
	var i Organization
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.AuthToken,
		&i.WebhookSecret,
		&i.Enabled,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getEnvironmentByName = `-- name: GetEnvironmentByName :one
SELECT id, name
FROM environments
WHERE name = ?
LIMIT 1
`

func (q *Queries) GetEnvironmentByName(ctx context.Context, name string) (Environment, error) {
	row := q.db.QueryRowContext(ctx, getEnvironmentByName, name)
	var i Environment
	err := row.Scan(&i.ID, &i.Name)
	return i, err
}

const getOrganizationByAuthToken = `-- name: GetOrganizationByAuthToken :one
SELECT id, name, auth_token, webhook_secret, enabled, created_at, updated_at
FROM organizations
WHERE auth_token = ?
LIMIT 1
`

func (q *Queries) GetOrganizationByAuthToken(ctx context.Context, authToken string) (Organization, error) {
	row := q.db.QueryRowContext(ctx, getOrganizationByAuthToken, authToken)
	var i Organization
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.AuthToken,
		&i.WebhookSecret,
		&i.Enabled,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getOrganizationByName = `-- name: GetOrganizationByName :one
SELECT id, name, auth_token, webhook_secret, enabled, created_at, updated_at
FROM organizations
WHERE name = ?
LIMIT 1
`

func (q *Queries) GetOrganizationByName(ctx context.Context, name string) (Organization, error) {
	row := q.db.QueryRowContext(ctx, getOrganizationByName, name)
	var i Organization
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.AuthToken,
		&i.WebhookSecret,
		&i.Enabled,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getServiceByName = `-- name: GetServiceByName :one
SELECT id, name, integration_type, description, context, team, repo_url, logs_url, endpoint_url, created_at, updated_at
FROM services
WHERE name = ?
LIMIT 1
`

func (q *Queries) GetServiceByName(ctx context.Context, name string) (Service, error) {
	row := q.db.QueryRowContext(ctx, getServiceByName, name)
	var i Service
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.IntegrationType,
		&i.Description,
		&i.Context,
		&i.Team,
		&i.RepoUrl,
		&i.LogsUrl,
		&i.EndpointUrl,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const listDeploymentHistoryByService = `-- name: ListDeploymentHistoryByService :many
SELECT
  d.deployed_at,
  d.commit_count,
  d.release_ref,
  d.release_url,
  e.name AS environment
FROM deployments d
JOIN environments e ON e.id = d.environment_id
WHERE d.service_id = ?
ORDER BY d.deployed_at DESC
LIMIT ?
`

type ListDeploymentHistoryByServiceParams struct {
	ServiceID int64
	Limit     int64
}

type ListDeploymentHistoryByServiceRow struct {
	DeployedAt  string
	CommitCount sql.NullInt64
	ReleaseRef  sql.NullString
	ReleaseUrl  sql.NullString
	Environment string
}

func (q *Queries) ListDeploymentHistoryByService(ctx context.Context, arg ListDeploymentHistoryByServiceParams) ([]ListDeploymentHistoryByServiceRow, error) {
	rows, err := q.db.QueryContext(ctx, listDeploymentHistoryByService, arg.ServiceID, arg.Limit)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []ListDeploymentHistoryByServiceRow
	for rows.Next() {
		var i ListDeploymentHistoryByServiceRow
		if err := rows.Scan(
			&i.DeployedAt,
			&i.CommitCount,
			&i.ReleaseRef,
			&i.ReleaseUrl,
			&i.Environment,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listDeployments = `-- name: ListDeployments :many
SELECT
  d.deployed_at,
  s.name AS service,
  e.name AS environment,
  d.status,
  d.job_url
FROM deployments d
JOIN services s ON s.id = d.service_id
JOIN environments e ON e.id = d.environment_id
WHERE (?1 = '' OR ?1 = 'all' OR e.name = ?1)
  AND (?2 = '' OR ?2 = 'all' OR s.name = ?2)
ORDER BY d.deployed_at DESC
`

type ListDeploymentsParams struct {
	Env     interface{}
	Service interface{}
}

type ListDeploymentsRow struct {
	DeployedAt  string
	Service     string
	Environment string
	Status      string
	JobUrl      sql.NullString
}

func (q *Queries) ListDeployments(ctx context.Context, arg ListDeploymentsParams) ([]ListDeploymentsRow, error) {
	rows, err := q.db.QueryContext(ctx, listDeployments, arg.Env, arg.Service)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []ListDeploymentsRow
	for rows.Next() {
		var i ListDeploymentsRow
		if err := rows.Scan(
			&i.DeployedAt,
			&i.Service,
			&i.Environment,
			&i.Status,
			&i.JobUrl,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listOrganizationRequiredFields = `-- name: ListOrganizationRequiredFields :many
SELECT id, organization_id, label, field_type, sort_order
FROM organization_required_fields
WHERE organization_id = ?
ORDER BY sort_order, id
`

type ListOrganizationRequiredFieldsRow struct {
	ID             int64
	OrganizationID int64
	Label          string
	FieldType      string
	SortOrder      int64
}

func (q *Queries) ListOrganizationRequiredFields(ctx context.Context, organizationID int64) ([]ListOrganizationRequiredFieldsRow, error) {
	rows, err := q.db.QueryContext(ctx, listOrganizationRequiredFields, organizationID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []ListOrganizationRequiredFieldsRow
	for rows.Next() {
		var i ListOrganizationRequiredFieldsRow
		if err := rows.Scan(
			&i.ID,
			&i.OrganizationID,
			&i.Label,
			&i.FieldType,
			&i.SortOrder,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listPendingCommitsNotInProd = `-- name: ListPendingCommitsNotInProd :many
WITH prod_release AS (
  SELECT id
  FROM releases
  WHERE service_id = ?1
    AND environment_id = (SELECT id FROM environments WHERE name = 'production')
  ORDER BY released_at DESC
  LIMIT 1
)
SELECT
  c.id,
  c.sha,
  c.message,
  c.url,
  c.committed_at
FROM commits c
WHERE c.service_id = ?1
  AND c.id NOT IN (
    SELECT rc.commit_id
    FROM release_commits rc
    JOIN prod_release pr ON pr.id = rc.release_id
  )
ORDER BY c.committed_at DESC
LIMIT ?2
`

type ListPendingCommitsNotInProdParams struct {
	ServiceID int64
	Limit     int64
}

type ListPendingCommitsNotInProdRow struct {
	ID          int64
	Sha         string
	Message     string
	Url         sql.NullString
	CommittedAt string
}

func (q *Queries) ListPendingCommitsNotInProd(ctx context.Context, arg ListPendingCommitsNotInProdParams) ([]ListPendingCommitsNotInProdRow, error) {
	rows, err := q.db.QueryContext(ctx, listPendingCommitsNotInProd, arg.ServiceID, arg.Limit)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []ListPendingCommitsNotInProdRow
	for rows.Next() {
		var i ListPendingCommitsNotInProdRow
		if err := rows.Scan(
			&i.ID,
			&i.Sha,
			&i.Message,
			&i.Url,
			&i.CommittedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listServiceEnvironments = `-- name: ListServiceEnvironments :many
SELECT
  e.name,
  r.released_at,
  r.ref,
  r.release_url
FROM releases r
JOIN environments e ON e.id = r.environment_id
WHERE r.service_id = ?
ORDER BY r.released_at DESC
`

type ListServiceEnvironmentsRow struct {
	Name       string
	ReleasedAt string
	Ref        string
	ReleaseUrl sql.NullString
}

func (q *Queries) ListServiceEnvironments(ctx context.Context, serviceID int64) ([]ListServiceEnvironmentsRow, error) {
	rows, err := q.db.QueryContext(ctx, listServiceEnvironments, serviceID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []ListServiceEnvironmentsRow
	for rows.Next() {
		var i ListServiceEnvironmentsRow
		if err := rows.Scan(
			&i.Name,
			&i.ReleasedAt,
			&i.Ref,
			&i.ReleaseUrl,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listServiceFields = `-- name: ListServiceFields :many
SELECT id, service_id, label, value, sort_order
FROM service_fields
WHERE service_id = ?
ORDER BY sort_order ASC, label ASC
`

func (q *Queries) ListServiceFields(ctx context.Context, serviceID int64) ([]ServiceField, error) {
	rows, err := q.db.QueryContext(ctx, listServiceFields, serviceID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []ServiceField
	for rows.Next() {
		var i ServiceField
		if err := rows.Scan(
			&i.ID,
			&i.ServiceID,
			&i.Label,
			&i.Value,
			&i.SortOrder,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listServiceInstances = `-- name: ListServiceInstances :many
SELECT
  si.id,
  si.service_id,
  s.name AS service_name,
  s.description,
  s.context,
  s.team,
  s.repo_url,
  s.logs_url,
  s.endpoint_url,
  e.name AS environment,
  si.status,
  si.last_deploy_at,
  si.deploy_duration_seconds,
  si.revision,
  si.commit_sha,
  si.commit_url,
  si.commit_index,
  si.action_label,
  si.action_kind,
  si.action_disabled
FROM service_instances si
JOIN services s ON s.id = si.service_id
JOIN environments e ON e.id = si.environment_id
ORDER BY s.name, e.name
`

type ListServiceInstancesRow struct {
	ID                    int64
	ServiceID             int64
	ServiceName           string
	Description           sql.NullString
	Context               sql.NullString
	Team                  sql.NullString
	RepoUrl               sql.NullString
	LogsUrl               sql.NullString
	EndpointUrl           sql.NullString
	Environment           string
	Status                string
	LastDeployAt          sql.NullString
	DeployDurationSeconds sql.NullInt64
	Revision              sql.NullString
	CommitSha             sql.NullString
	CommitUrl             sql.NullString
	CommitIndex           sql.NullInt64
	ActionLabel           sql.NullString
	ActionKind            sql.NullString
	ActionDisabled        int64
}

func (q *Queries) ListServiceInstances(ctx context.Context) ([]ListServiceInstancesRow, error) {
	rows, err := q.db.QueryContext(ctx, listServiceInstances)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []ListServiceInstancesRow
	for rows.Next() {
		var i ListServiceInstancesRow
		if err := rows.Scan(
			&i.ID,
			&i.ServiceID,
			&i.ServiceName,
			&i.Description,
			&i.Context,
			&i.Team,
			&i.RepoUrl,
			&i.LogsUrl,
			&i.EndpointUrl,
			&i.Environment,
			&i.Status,
			&i.LastDeployAt,
			&i.DeployDurationSeconds,
			&i.Revision,
			&i.CommitSha,
			&i.CommitUrl,
			&i.CommitIndex,
			&i.ActionLabel,
			&i.ActionKind,
			&i.ActionDisabled,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listServiceInstancesByEnv = `-- name: ListServiceInstancesByEnv :many
SELECT
  si.id,
  si.service_id,
  s.name AS service_name,
  s.description,
  s.context,
  s.team,
  s.repo_url,
  s.logs_url,
  s.endpoint_url,
  e.name AS environment,
  si.status,
  si.last_deploy_at,
  si.deploy_duration_seconds,
  si.revision,
  si.commit_sha,
  si.commit_url,
  si.commit_index,
  si.action_label,
  si.action_kind,
  si.action_disabled
FROM service_instances si
JOIN services s ON s.id = si.service_id
JOIN environments e ON e.id = si.environment_id
WHERE e.name = ?
ORDER BY s.name, e.name
`

type ListServiceInstancesByEnvRow struct {
	ID                    int64
	ServiceID             int64
	ServiceName           string
	Description           sql.NullString
	Context               sql.NullString
	Team                  sql.NullString
	RepoUrl               sql.NullString
	LogsUrl               sql.NullString
	EndpointUrl           sql.NullString
	Environment           string
	Status                string
	LastDeployAt          sql.NullString
	DeployDurationSeconds sql.NullInt64
	Revision              sql.NullString
	CommitSha             sql.NullString
	CommitUrl             sql.NullString
	CommitIndex           sql.NullInt64
	ActionLabel           sql.NullString
	ActionKind            sql.NullString
	ActionDisabled        int64
}

func (q *Queries) ListServiceInstancesByEnv(ctx context.Context, name string) ([]ListServiceInstancesByEnvRow, error) {
	rows, err := q.db.QueryContext(ctx, listServiceInstancesByEnv, name)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []ListServiceInstancesByEnvRow
	for rows.Next() {
		var i ListServiceInstancesByEnvRow
		if err := rows.Scan(
			&i.ID,
			&i.ServiceID,
			&i.ServiceName,
			&i.Description,
			&i.Context,
			&i.Team,
			&i.RepoUrl,
			&i.LogsUrl,
			&i.EndpointUrl,
			&i.Environment,
			&i.Status,
			&i.LastDeployAt,
			&i.DeployDurationSeconds,
			&i.Revision,
			&i.CommitSha,
			&i.CommitUrl,
			&i.CommitIndex,
			&i.ActionLabel,
			&i.ActionKind,
			&i.ActionDisabled,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const markServiceIntegrationType = `-- name: MarkServiceIntegrationType :exec
UPDATE services
SET integration_type = ?, updated_at = CURRENT_TIMESTAMP
WHERE id = ?
`

type MarkServiceIntegrationTypeParams struct {
	IntegrationType string
	ID              int64
}

func (q *Queries) MarkServiceIntegrationType(ctx context.Context, arg MarkServiceIntegrationTypeParams) error {
	_, err := q.db.ExecContext(ctx, markServiceIntegrationType, arg.IntegrationType, arg.ID)
	return err
}

const updateOrganizationSecrets = `-- name: UpdateOrganizationSecrets :exec
UPDATE organizations
SET auth_token = ?, webhook_secret = ?, enabled = ?, updated_at = CURRENT_TIMESTAMP
WHERE id = ?
`

type UpdateOrganizationSecretsParams struct {
	AuthToken     string
	WebhookSecret string
	Enabled       int64
	ID            int64
}

func (q *Queries) UpdateOrganizationSecrets(ctx context.Context, arg UpdateOrganizationSecretsParams) error {
	_, err := q.db.ExecContext(ctx, updateOrganizationSecrets,
		arg.AuthToken,
		arg.WebhookSecret,
		arg.Enabled,
		arg.ID,
	)
	return err
}

const updateServiceInstanceStatus = `-- name: UpdateServiceInstanceStatus :exec
UPDATE service_instances
SET status = ?,
    last_deploy_at = ?,
    updated_at = CURRENT_TIMESTAMP
WHERE id = ?
`

type UpdateServiceInstanceStatusParams struct {
	Status       string
	LastDeployAt sql.NullString
	ID           int64
}

func (q *Queries) UpdateServiceInstanceStatus(ctx context.Context, arg UpdateServiceInstanceStatusParams) error {
	_, err := q.db.ExecContext(ctx, updateServiceInstanceStatus, arg.Status, arg.LastDeployAt, arg.ID)
	return err
}

const upsertServiceInstance = `-- name: UpsertServiceInstance :one
INSERT INTO service_instances (
  service_id,
  environment_id,
  status,
  last_deploy_at,
  revision,
  commit_sha,
  commit_url,
  action_label,
  action_kind,
  action_disabled,
  updated_at
)
VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, CURRENT_TIMESTAMP)
ON CONFLICT(service_id, environment_id) DO UPDATE SET
  status = excluded.status,
  last_deploy_at = excluded.last_deploy_at,
  revision = excluded.revision,
  commit_sha = excluded.commit_sha,
  commit_url = excluded.commit_url,
  action_label = excluded.action_label,
  action_kind = excluded.action_kind,
  action_disabled = excluded.action_disabled,
  updated_at = CURRENT_TIMESTAMP
RETURNING id, service_id, environment_id, status, last_deploy_at, deploy_duration_seconds, revision, commit_sha, commit_url, commit_index, action_label, action_kind, action_disabled, created_at, updated_at
`

type UpsertServiceInstanceParams struct {
	ServiceID      int64
	EnvironmentID  int64
	Status         string
	LastDeployAt   sql.NullString
	Revision       sql.NullString
	CommitSha      sql.NullString
	CommitUrl      sql.NullString
	ActionLabel    sql.NullString
	ActionKind     sql.NullString
	ActionDisabled int64
}

func (q *Queries) UpsertServiceInstance(ctx context.Context, arg UpsertServiceInstanceParams) (ServiceInstance, error) {
	row := q.db.QueryRowContext(ctx, upsertServiceInstance,
		arg.ServiceID,
		arg.EnvironmentID,
		arg.Status,
		arg.LastDeployAt,
		arg.Revision,
		arg.CommitSha,
		arg.CommitUrl,
		arg.ActionLabel,
		arg.ActionKind,
		arg.ActionDisabled,
	)
	var i ServiceInstance
	err := row.Scan(
		&i.ID,
		&i.ServiceID,
		&i.EnvironmentID,
		&i.Status,
		&i.LastDeployAt,
		&i.DeployDurationSeconds,
		&i.Revision,
		&i.CommitSha,
		&i.CommitUrl,
		&i.CommitIndex,
		&i.ActionLabel,
		&i.ActionKind,
		&i.ActionDisabled,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}
