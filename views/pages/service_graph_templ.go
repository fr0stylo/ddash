// Code generated by templ - DO NOT EDIT.

// templ: version: v0.3.977
package pages

//lint:file-ignore SA4006 This context is only used if a nested component is present.

import "github.com/a-h/templ"
import templruntime "github.com/a-h/templ/runtime"

import "github.com/fr0stylo/ddash/views/base"

func ServiceGraphPage() templ.Component {
	return templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
		templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
		if templ_7745c5c3_CtxErr := ctx.Err(); templ_7745c5c3_CtxErr != nil {
			return templ_7745c5c3_CtxErr
		}
		templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
		if !templ_7745c5c3_IsBuffer {
			defer func() {
				templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
				if templ_7745c5c3_Err == nil {
					templ_7745c5c3_Err = templ_7745c5c3_BufErr
				}
			}()
		}
		ctx = templ.InitializeContext(ctx)
		templ_7745c5c3_Var1 := templ.GetChildren(ctx)
		if templ_7745c5c3_Var1 == nil {
			templ_7745c5c3_Var1 = templ.NopComponent
		}
		ctx = templ.ClearChildren(ctx)
		templ_7745c5c3_Var2 := templruntime.GeneratedTemplate(func(templ_7745c5c3_Input templruntime.GeneratedComponentInput) (templ_7745c5c3_Err error) {
			templ_7745c5c3_W, ctx := templ_7745c5c3_Input.Writer, templ_7745c5c3_Input.Context
			templ_7745c5c3_Buffer, templ_7745c5c3_IsBuffer := templruntime.GetBuffer(templ_7745c5c3_W)
			if !templ_7745c5c3_IsBuffer {
				defer func() {
					templ_7745c5c3_BufErr := templruntime.ReleaseBuffer(templ_7745c5c3_Buffer)
					if templ_7745c5c3_Err == nil {
						templ_7745c5c3_Err = templ_7745c5c3_BufErr
					}
				}()
			}
			ctx = templ.InitializeContext(ctx)
			templ_7745c5c3_Err = base.AppHeader("Service dependency graph", "Visualize dependencies and dependants across services").Render(ctx, templ_7745c5c3_Buffer)
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			templ_7745c5c3_Err = templruntime.WriteString(templ_7745c5c3_Buffer, 1, " <main class=\"mx-auto max-w-7xl px-4 py-8 sm:px-6 lg:px-8\"><div class=\"rounded-2xl border border-gray-200 bg-white p-5 shadow-sm\"><div class=\"mb-4 flex flex-col gap-3 xl:flex-row xl:items-center xl:justify-between\"><div><h2 class=\"text-base font-semibold text-gray-900\">Dependency graph</h2><p class=\"text-xs text-gray-500\">Developer view: click nodes to inspect, drag to pin, use layout controls to reflow.</p></div><div class=\"flex flex-wrap items-center gap-2\"><span id=\"graph-stats\" class=\"inline-flex h-8 items-center rounded-lg border border-gray-200 bg-gray-50 px-3 text-xs text-gray-600\">Loading...</span> <a href=\"/\" class=\"inline-flex h-8 items-center rounded-lg border border-gray-200 bg-white px-3 text-xs font-medium text-gray-700 shadow-sm hover:bg-gray-50\">Back to dashboard</a></div></div><div class=\"mb-3 flex flex-col gap-2 lg:flex-row lg:items-center lg:justify-between\"><div class=\"flex flex-wrap items-center gap-2\"><button id=\"graph-layout-cose\" type=\"button\" class=\"inline-flex h-8 items-center rounded-lg border border-gray-200 bg-white px-3 text-xs font-medium text-gray-700 hover:bg-gray-50\">Force layout</button> <button id=\"graph-layout-breadth\" type=\"button\" class=\"inline-flex h-8 items-center rounded-lg border border-gray-200 bg-white px-3 text-xs font-medium text-gray-700 hover:bg-gray-50\">Dependency flow</button> <button id=\"graph-fit\" type=\"button\" class=\"inline-flex h-8 items-center rounded-lg border border-gray-200 bg-white px-3 text-xs font-medium text-gray-700 hover:bg-gray-50\">Fit</button></div><div class=\"flex items-center gap-2\"><input id=\"graph-search\" type=\"text\" class=\"h-8 w-56 rounded-lg border border-gray-200 bg-white px-3 text-xs text-gray-700 outline-none focus:border-gray-300 focus:ring-2 focus:ring-gray-200\" placeholder=\"Find service...\"> <button id=\"graph-clear-search\" type=\"button\" class=\"inline-flex h-8 items-center rounded-lg border border-gray-200 bg-white px-3 text-xs font-medium text-gray-700 hover:bg-gray-50\">Clear</button></div></div><div class=\"grid gap-4 xl:grid-cols-[1fr_280px]\"><div><div id=\"graph-empty\" class=\"rounded-lg border border-dashed border-gray-200 bg-gray-50 px-4 py-8 text-sm text-gray-500\">Loading graph...</div><div id=\"graph-canvas\" class=\"hidden h-[720px] w-full rounded-xl border border-gray-100 bg-gradient-to-b from-white to-gray-50\"></div></div><aside id=\"graph-inspector\" class=\"rounded-xl border border-gray-200 bg-gray-50 p-3\"><div class=\"text-xs font-semibold uppercase tracking-wide text-gray-500\">Inspector</div><div id=\"graph-inspector-empty\" class=\"mt-2 text-sm text-gray-500\">Select a service node to inspect relationships.</div><div id=\"graph-inspector-content\" class=\"mt-3 hidden space-y-3\"><div><div id=\"graph-node-name\" class=\"text-sm font-semibold text-gray-900\"></div><div id=\"graph-node-degree\" class=\"text-xs text-gray-500\"></div></div><div><div class=\"mb-1 text-[11px] font-semibold uppercase tracking-wide text-gray-500\">Depends on</div><div id=\"graph-node-out\" class=\"space-y-1 text-sm text-gray-700\"></div></div><div><div class=\"mb-1 text-[11px] font-semibold uppercase tracking-wide text-gray-500\">Dependants</div><div id=\"graph-node-in\" class=\"space-y-1 text-sm text-gray-700\"></div></div><a id=\"graph-open-service\" class=\"inline-flex h-8 items-center rounded-lg border border-gray-200 bg-white px-3 text-xs font-medium text-gray-700 hover:bg-gray-100\" href=\"#\">Open service details</a></div></aside></div></div></main><script src=\"https://unpkg.com/cytoscape@3.33.1/dist/cytoscape.min.js\"></script> <script>\n\t\t\t(() => {\n\t\t\t\tconst empty = document.getElementById('graph-empty')\n\t\t\t\tconst canvas = document.getElementById('graph-canvas')\n\t\t\t\tconst stats = document.getElementById('graph-stats')\n\t\t\t\tconst search = document.getElementById('graph-search')\n\t\t\t\tconst clearSearch = document.getElementById('graph-clear-search')\n\t\t\t\tconst layoutCoseButton = document.getElementById('graph-layout-cose')\n\t\t\t\tconst layoutBreadthButton = document.getElementById('graph-layout-breadth')\n\t\t\t\tconst fitButton = document.getElementById('graph-fit')\n\n\t\t\t\tconst inspectorEmpty = document.getElementById('graph-inspector-empty')\n\t\t\t\tconst inspectorContent = document.getElementById('graph-inspector-content')\n\t\t\t\tconst inspectorName = document.getElementById('graph-node-name')\n\t\t\t\tconst inspectorDegree = document.getElementById('graph-node-degree')\n\t\t\t\tconst inspectorOut = document.getElementById('graph-node-out')\n\t\t\t\tconst inspectorIn = document.getElementById('graph-node-in')\n\t\t\t\tconst inspectorOpen = document.getElementById('graph-open-service')\n\n\t\t\t\tlet cy = null\n\n\t\t\t\tfunction renderList(el, values, fallback) {\n\t\t\t\t\tel.innerHTML = ''\n\t\t\t\t\tif (!values || values.length === 0) {\n\t\t\t\t\t\tconst emptyRow = document.createElement('div')\n\t\t\t\t\t\temptyRow.className = 'text-xs text-gray-500'\n\t\t\t\t\t\temptyRow.textContent = fallback\n\t\t\t\t\t\tel.appendChild(emptyRow)\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\tfor (const value of values) {\n\t\t\t\t\t\tconst link = document.createElement('a')\n\t\t\t\t\t\tlink.className = 'block rounded-md border border-gray-200 bg-white px-2 py-1 text-xs font-medium text-gray-700 hover:bg-gray-100 text-center'\n\t\t\t\t\t\tlink.href = `/s/${encodeURIComponent(value)}`\n\t\t\t\t\t\tlink.textContent = value\n\t\t\t\t\t\tel.appendChild(link)\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfunction inspectNode(node) {\n\t\t\t\t\tif (!node) {\n\t\t\t\t\t\tinspectorContent.classList.add('hidden')\n\t\t\t\t\t\tinspectorEmpty.classList.remove('hidden')\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\tinspectorEmpty.classList.add('hidden')\n\t\t\t\t\tinspectorContent.classList.remove('hidden')\n\n\t\t\t\t\tconst id = node.id()\n\t\t\t\t\tconst dependsOn = node.outgoers('node').map((n) => n.id()).sort()\n\t\t\t\t\tconst dependants = node.incomers('node').map((n) => n.id()).sort()\n\n\t\t\t\t\tinspectorName.textContent = id\n\t\t\t\t\tinspectorDegree.textContent = `${dependants.length} dependants, ${dependsOn.length} dependencies`\n\t\t\t\t\trenderList(inspectorOut, dependsOn, 'No upstream dependencies')\n\t\t\t\t\trenderList(inspectorIn, dependants, 'No downstream dependants')\n\t\t\t\t\tinspectorOpen.href = `/s/${encodeURIComponent(id)}`\n\t\t\t\t}\n\n\t\t\t\tfunction runLayout(name) {\n\t\t\t\t\tif (!cy) return\n\t\t\t\t\tconst options = name === 'breadthfirst'\n\t\t\t\t\t\t? { name: 'breadthfirst', directed: true, spacingFactor: 1.45, avoidOverlap: true, fit: true, padding: 56, animate: true, animationDuration: 320 }\n\t\t\t\t\t\t: { name: 'cose', animate: true, animationDuration: 360, fit: true, padding: 56, nodeRepulsion: 1400000, idealEdgeLength: 185, edgeElasticity: 110, nodeDimensionsIncludeLabels: true }\n\t\t\t\t\tcy.layout(options).run()\n\t\t\t\t}\n\n\t\t\t\tfunction applySearch(value) {\n\t\t\t\t\tif (!cy) return\n\t\t\t\t\tconst term = value.trim().toLowerCase()\n\t\t\t\t\tif (!term) {\n\t\t\t\t\t\tcy.elements().removeClass('is-dim is-match')\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t\tcy.elements().addClass('is-dim').removeClass('is-match')\n\t\t\t\t\tconst matches = cy.nodes().filter((n) => n.id().toLowerCase().includes(term))\n\t\t\t\t\tmatches.removeClass('is-dim').addClass('is-match')\n\t\t\t\t\tmatches.connectedEdges().removeClass('is-dim').addClass('is-match')\n\t\t\t\t\tmatches.neighborhood().removeClass('is-dim')\n\t\t\t\t}\n\n\t\t\t\tfetch('/api/services/graph', { credentials: 'same-origin' })\n\t\t\t\t\t.then((r) => {\n\t\t\t\t\t\tif (!r.ok) throw new Error(`graph fetch failed: ${r.status}`)\n\t\t\t\t\t\treturn r.json()\n\t\t\t\t\t})\n\t\t\t\t\t.then((graph) => {\n\t\t\t\t\t\tif (typeof window.cytoscape !== 'function') throw new Error('Cytoscape failed to load')\n\t\t\t\t\t\tconst nodes = Array.isArray(graph.nodes) ? graph.nodes : []\n\t\t\t\t\t\tconst edges = Array.isArray(graph.edges) ? graph.edges : []\n\t\t\t\t\t\tstats.textContent = `${nodes.length} services, ${edges.length} dependencies`\n\n\t\t\t\t\t\tif (nodes.length === 0) {\n\t\t\t\t\t\t\tempty.textContent = 'No dependency data yet. Add dependencies from service details.'\n\t\t\t\t\t\t\tstats.textContent = 'No graph data'\n\t\t\t\t\t\t\tlayoutCoseButton.disabled = true\n\t\t\t\t\t\t\tlayoutBreadthButton.disabled = true\n\t\t\t\t\t\t\tfitButton.disabled = true\n\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tempty.classList.add('hidden')\n\t\t\t\t\t\tcanvas.classList.remove('hidden')\n\n\t\t\t\t\t\tcy = window.cytoscape({\n\t\t\t\t\t\t\tcontainer: canvas,\n\t\t\t\t\t\t\telements: [\n\t\t\t\t\t\t\t\t...nodes.map((node) => ({ data: { id: node.id, label: node.name || node.id } })),\n\t\t\t\t\t\t\t\t...edges.map((edge, i) => ({ data: { id: `e-${i}-${edge.from}-${edge.to}`, source: edge.from, target: edge.to } })),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\tlayout: {\n\t\t\t\t\t\t\t\tname: 'cose',\n\t\t\t\t\t\t\t\tanimate: true,\n\t\t\t\t\t\t\t\tanimationDuration: 380,\n\t\t\t\t\t\t\t\tfit: true,\n\t\t\t\t\t\t\t\tpadding: 56,\n\t\t\t\t\t\t\t\tnodeRepulsion: 1400000,\n\t\t\t\t\t\t\t\tidealEdgeLength: 185,\n\t\t\t\t\t\t\t\tedgeElasticity: 110,\n\t\t\t\t\t\t\t\tnodeDimensionsIncludeLabels: true,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tstyle: [\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tselector: 'node',\n\t\t\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\t\t\t'label': 'data(label)',\n\t\t\t\t\t\t\t\t\t\t'color': '#334155',\n\t\t\t\t\t\t\t\t\t\t'font-size': 12,\n\t\t\t\t\t\t\t\t\t\t'font-weight': 500,\n\t\t\t\t\t\t\t\t\t\t'text-valign': 'center',\n\t\t\t\t\t\t\t\t\t\t'text-halign': 'left',\n\t\t\t\t\t\t\t\t\t\t'text-margin-x': 14,\n\t\t\t\t\t\t\t\t\t\t'text-background-color': '#ffffff',\n\t\t\t\t\t\t\t\t\t\t'text-background-opacity': 0.9,\n\t\t\t\t\t\t\t\t\t\t'text-background-padding': 2,\n\t\t\t\t\t\t\t\t\t\t'background-color': '#0f172a',\n\t\t\t\t\t\t\t\t\t\t'border-color': '#ffffff',\n\t\t\t\t\t\t\t\t\t\t'border-width': 2,\n\t\t\t\t\t\t\t\t\t\t'width': 16,\n\t\t\t\t\t\t\t\t\t\t'height': 16,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tselector: 'edge',\n\t\t\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\t\t\t'curve-style': 'bezier',\n\t\t\t\t\t\t\t\t\t\t'line-color': '#cbd5e1',\n\t\t\t\t\t\t\t\t\t\t'target-arrow-color': '#cbd5e1',\n\t\t\t\t\t\t\t\t\t\t'target-arrow-shape': 'triangle',\n\t\t\t\t\t\t\t\t\t\t'arrow-scale': 0.85,\n\t\t\t\t\t\t\t\t\t\t'width': 1.6,\n\t\t\t\t\t\t\t\t\t\t'opacity': 0.9,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t{ selector: '.is-dim', style: { opacity: 0.12 } },\n\t\t\t\t\t\t\t\t{ selector: '.is-match', style: { opacity: 1 } },\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tselector: '.is-focus',\n\t\t\t\t\t\t\t\t\tstyle: {\n\t\t\t\t\t\t\t\t\t\t'background-color': '#111827',\n\t\t\t\t\t\t\t\t\t\t'width': 18,\n\t\t\t\t\t\t\t\t\t\t'height': 18,\n\t\t\t\t\t\t\t\t\t\t'font-weight': 700,\n\t\t\t\t\t\t\t\t\t\t'color': '#111827',\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t})\n\n\t\t\t\t\t\tcy.on('tap', 'node', (evt) => {\n\t\t\t\t\t\t\tconst node = evt.target\n\t\t\t\t\t\t\tcy.elements().removeClass('is-focus')\n\t\t\t\t\t\t\tnode.addClass('is-focus')\n\t\t\t\t\t\t\tnode.connectedEdges().addClass('is-focus')\n\t\t\t\t\t\t\tinspectNode(node)\n\t\t\t\t\t\t})\n\n\t\t\t\t\t\tcy.on('tap', (evt) => {\n\t\t\t\t\t\t\tif (evt.target === cy) {\n\t\t\t\t\t\t\t\tcy.elements().removeClass('is-focus')\n\t\t\t\t\t\t\t\tinspectNode(null)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\n\t\t\t\t\t\tlayoutCoseButton.addEventListener('click', () => runLayout('cose'))\n\t\t\t\t\t\tlayoutBreadthButton.addEventListener('click', () => runLayout('breadthfirst'))\n\t\t\t\t\t\tfitButton.addEventListener('click', () => cy.fit(cy.elements(), 36))\n\n\t\t\t\t\t\tsearch.addEventListener('input', () => applySearch(search.value))\n\t\t\t\t\t\tclearSearch.addEventListener('click', () => {\n\t\t\t\t\t\t\tsearch.value = ''\n\t\t\t\t\t\t\tapplySearch('')\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t\t\t.catch((err) => {\n\t\t\t\t\t\tempty.textContent = `Unable to load graph: ${err.message}`\n\t\t\t\t\t\tstats.textContent = 'Graph unavailable'\n\t\t\t\t\t\tlayoutCoseButton.disabled = true\n\t\t\t\t\t\tlayoutBreadthButton.disabled = true\n\t\t\t\t\t\tfitButton.disabled = true\n\t\t\t\t\t})\n\t\t\t})()\n\t\t</script>")
			if templ_7745c5c3_Err != nil {
				return templ_7745c5c3_Err
			}
			return nil
		})
		templ_7745c5c3_Err = base.Doc("Service dependency graph").Render(templ.WithChildren(ctx, templ_7745c5c3_Var2), templ_7745c5c3_Buffer)
		if templ_7745c5c3_Err != nil {
			return templ_7745c5c3_Err
		}
		return nil
	})
}

var _ = templruntime.GeneratedTemplate
